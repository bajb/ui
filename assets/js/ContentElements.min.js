!function(a){function b(a){this._ele=a,this._options=[],this._definitions=[],this._rules=[]}a.fn.qb=function(c,d){if(c||(c="init"),"function"!=typeof b.prototype[c])return void console.error("QueryBuilder command '"+c+"' not found");var e=Array.prototype.slice.call(arguments);e.shift();var f=a(this);return a(this).each(function(){var d=a(this),g=d.data("qb");g||(d.data("qb",new b(this)),g=d.data("qb"));var h=g[c].apply(g,e);h&&(f=h)}),f},a(document).on("change",".qb-rule .qb-key",function(){a(this).closest(".qb-container").qb("addRule",{key:a(this).val()},a(this).closest(".qb-rules .qb-rule").index())}),a(document).on("click","button.qb-remove-rule",function(){a(this).closest(".qb-container").qb("removeRule",a(this).closest(".qb-rules .qb-rule").index())}),a(document).on("click","button.qb-add-rule",function(){a(this).closest(".qb-container").qb("addRule")}),b.prototype.init=function(b){this.options(b);var c=a(this._ele);c.attr("data-qb-definitions")&&this.definitions(c.attr("data-qb-definitions")),c.attr("data-qb-rules")&&this.rules(c.attr("data-qb-rules"))},b.prototype.options=function(a){return"undefined"==typeof a?this._options:(this._options=a,void this.redraw())},b.prototype.definitions=function(b){var c=this;return"undefined"==typeof b?this._definitions:"string"==typeof b?void a.getJSON(b,{},function(a){c._definitions=a,c.redraw()}):(this._definitions=b,void this.redraw())},b.prototype.rules=function(b){var c=this;if("undefined"==typeof b){var d=[];return a(".qb-rules .qb-rule",a(this._ele)).each(function(){var b=a(".qb-key",this).val();b&&d.push({key:b,comparator:a(".qb-comparator",this).val(),value:a(".qb-value",this).val()})}),d}if("string"==typeof b){if("query"!==b)return void a.getJSON(b,{},function(a){c._rules=a,c.redraw()});var e=[],f=a.parseParams(window.location.search.substring(1));a.each(f,function(a,b){e.push("object"==typeof b?{key:a,comparator:"in",value:this}:{key:a,comparator:"eq",value:this})}),b=e}this._rules=b,this.redraw()},b.prototype.redraw=function(){var b=this;a(this._ele).hasClass("qb-container")?a(".qb-rules",this._ele).empty():a(this._ele).addClass("qb-container").html(a('<div class="qb-rules"/>')).append(a('<button class="qb-button qb-add-rule">+</button>')),b._definitions&&b._rules&&a.each(b._rules,function(){b.addRule(this)})};var c={eq:{string:"text",number:"number",date:"date"},neq:{string:"text",number:"number",date:"date"},"in":{string:"token",number:"token"},nin:{string:"token",number:"token"},gt:{number:"number",date:"date",decimal:"decimal"},gte:{number:"number",date:"date",decimal:"decimal"},lt:{number:"number",date:"date",decimal:"decimal"},lte:{number:"number",date:"date",decimal:"decimal"},bet:{number:"number",date:"date",decimal:"decimal"},age:{date:"age"}};b.prototype.removeRule=function(b){a(".qb-rules .qb-rule",this._ele).get(b).remove(),a(".qb-rule",this._ele).length||this.addRule()},b.prototype.addRule=function(b,d){function e(){var d,e;if(e=b.comparator||"bool"!=i.dataType?c[b.comparator][i.dataType]:"bool","text"==e&&i.values&&!i.ajaxUrl&&(e="select"),!e)return void console.error("Input type not found for "+b.comparator+" "+i.dataType);switch(e){case"text":d=a('<input type="text" value="'+(b.value?b.value:"")+'"/>');break;case"number":d=a('<input type="number" value="'+(b.value?b.value:"")+'"/>');break;case"bool":d=a('<select><option value="1">True</option><option value="0">False</option></select>');break;case"select":d=a("<select/>"),a.each(i.values,function(a){d.append('<option value="'+a+'">'+this+"</option>")});break;case"token":d=a('<input type="text" value="'+(b.value?b.value:"")+'"/>');break;default:return void console.error("Input type not found for "+e)}return d.addClass("qb-value"),d}var f=a('<div class="qb-rule"/>'),g=a('<select class="qb-key"/>').appendTo(f),h=b?b.key:null,i=h?this._definitions[h]:null;if(h||g.append("<option> - SELECT -</option>"),!h||i){if(a.each(this._definitions,function(a){var b=h==a;g.append('<option value="'+a+'"'+(b?' selected="selected"':"")+">"+this.display+"</option>")}),i){if(i.dataType||(i.dataType="string"),i.comparators){var j=a('<select class="qb-comparator"/>').appendTo(f);a.each(i.comparators,function(a){b.comparator||(b.comparator=a);var c=b.comparator==a;j.append('<option value="'+a+'"'+(c?' selected="selected"':"")+">"+this+"</option>")})}e().appendTo(f)}a('<button class="qb-button qb-remove-rule">x</button>').appendTo(f),"undefined"!=typeof d?a(".qb-rule:eq("+d+")",this._ele).replaceWith(f):f.appendTo(a(".qb-rules",this._ele))}},a(document).trigger("qb.ready")}(jQuery);var FortifiContentElements={};