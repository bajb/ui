!function(a){"use strict";function b(a,b,c,d){this._queryBuilder=a,this._key=b||"",this._comparator=c||"",this._value=d||"",this._element=null,this.initValue()}function c(a){this._ele=a,this._options={},this._definitions=[],this._rules=[],this._initialisedRules=!1,this._initialisedDefinitions=!1,this._inputMethods={},this._inputTypes={},this._comparatorNames={},this.setInputMethod(n,d),this.setInputMethod(o,e),this.setInputMethod(p,f),this.setInputMethod(q,h),this.setInputMethod(r,j),this.setInputMethod(s,i),this.setInputMethod(t,g),this.setInputMethod(u,g),this.setInputType(A,v,n),this.setInputType(A,w,o),this.setInputType(A,y,s),this.setInputType(A,z,t),this.setInputType(B,v,n),this.setInputType(B,w,o),this.setInputType(B,y,s),this.setInputType(B,z,t),this.setInputType(C,v,n),this.setInputType(C,w,o),this.setInputType(C,y,s),this.setInputType(C,z,t),this.setInputType(D,v,r),this.setInputType(D,w,r),this.setInputType(E,v,r),this.setInputType(E,w,r),this.setInputType(F,w,o),this.setInputType(F,y,s),this.setInputType(F,x,p),this.setInputType(G,w,o),this.setInputType(G,y,s),this.setInputType(G,x,p),this.setInputType(H,w,o),this.setInputType(H,y,s),this.setInputType(H,x,p),this.setInputType(I,w,o),this.setInputType(I,y,s),this.setInputType(I,x,p),this.setInputType(J,w,o),this.setInputType(J,y,s),this.setInputType(J,x,p),this.setInputType(K,y,u),this.setInputType(L,v,n),this.setInputType(M,v,n),this.setInputType(N,v,n),this.setComparatorName(A,"Equals"),this.setComparatorName(B,"Equals (insensitive)"),this.setComparatorName(C,"Does Not Equal"),this.setComparatorName(D,"In"),this.setComparatorName(E,"Not In"),this.setComparatorName(F,"Greater Than"),this.setComparatorName(G,"Greater Than or Equal to"),this.setComparatorName(H,"Less Than"),this.setComparatorName(I,"Less Than or Equal to"),this.setComparatorName(J,"Between"),this.setComparatorName(K,"was"),this.setComparatorName(L,"Like"),this.setComparatorName(M,"Starts With"),this.setComparatorName(N,"Ends With")}function d(){return a('<input type="text"/>').attr("value",this.getValue())}function e(){return a('<input type="number"/>').attr("value",this.getValue())}function f(){return a('<input type="number" step="0.01" />').attr("value",this.getValue())}function g(){return k({1:"True",0:"False"},this.getValue())}function h(){return k(this.getDefinition().values,this.getValue())}function i(){return a('<input type="date"/>').attr("value",this.getValue())}function j(){return a('<input type="text"/>').attr("value",this.getValue())}function k(b,c){var d=a("<select/>");return a.each(b,function(b){var e=a("<option/>").text(this).attr("value",b);b==c&&e.attr("selected","selected"),d.append(e)}),d}const l="querybuilder",m=l+".rule",n="text",o="number",p="decimal",q="select",r="token",s="date",t="bool",u="age",v="string",w="number",x="decimal",y="date",z="bool",A="eq",B="eqi",C="neq",D="in",E="nin",F="gt",G="gte",H="lt",I="lte",J="bet",K="age",L="like",M="starts",N="ends";a.fn.QueryBuilder=function(b){var d=Array.prototype.slice.call(arguments);if(b?"object"==typeof b&&(b="init",d.unshift("init")):b="init","function"!=typeof c.prototype[b])throw"QueryBuilder command '"+b+"' not found";d.shift();var e=a(this);return a(this).each(function(){var f=a(this),g=f.data(l);g||(f.data(l,new c(this)),g=f.data(l));var h=g[b].apply(g,d);h&&(e=h)}),e},a(document).on("change",".qb-rule .qb-key",function(){var b=a(this).closest(".qb-container"),c=b.data(l),d=a(this).closest(".qb-rule"),e=d.data(m);e.setKey(a(this).val()),e.render(),b.trigger("change.querybuilder",[c.rules()])}),a(document).on("change",".qb-rule .qb-comparator",function(){var b=a(this).closest(".qb-container"),c=b.data(l),d=a(this).closest(".qb-rule"),e=d.data(m);e.setComparator(a(this).val()),e.render(),b.trigger("change.querybuilder",[c.rules()])}),a(document).on("change",".qb-container .qb-value",function(){var b=a(this).closest(".qb-container"),c=b.data(l),d=a(this).closest(".qb-rule"),e=d.data(m);e.setValue(a(this).val()),b.trigger("change.querybuilder",[c.rules()])}),a(document).on("click","button.qb-remove-rule",function(){var b=a(this).closest(".qb-container"),c=b.data(l),d=a(this).closest(".qb-rule"),e=d.data(m);c.removeRule(e),b.trigger("change.querybuilder",[c.rules()])}),a(document).on("click","button.qb-add-rule",function(){a(this).closest(".qb-container").QueryBuilder("addRule")});var O=function(b){if(this.key="",this.display="- SELECT -",this.dataType=v,this.comparators=[A],this.inputType=null,this.required=!1,this.unique=!1,this.values="",this.ajaxUrl="",this.count=0,b){var c=this;a.each(b,function(a,b){c.hasOwnProperty(a)&&(c[a]=b)})}};!function(){function c(){var a,b=d.call(this),c=this._queryBuilder.getInputMethod(b);if(!c)throw"Input type not found for "+this.getComparator()+" "+this.getDefinition().dataType;return a=c.call(this),a.addClass("qb-value"),a}function d(){var a=this.getDefinition(),b=this._queryBuilder,c=a&&a.inputType?a.inputType:null;if(!c){var d=a&&a.dataType?a.dataType:v;c=b.getInputType(this.getComparator(),d)}return c==n&&a&&a.values&&!a.ajaxUrl&&(c=q),c!=q||!this.getValue()||a&&this.getValue()in a.values||(c=n),c}b.prototype.constructor=b,b.prototype.getValue=function(){return this._element&&a(".qb-value",this._element).length?a(".qb-value",this._element).val():this._value},b.prototype.setValue=function(b){this._value=b,this._element&&a(".qb-value",this._element).length&&a(".qb-value",this._element).val(b)},b.prototype.getComparator=function(){return this._element&&a(".qb-comparator",this._element).length?a(".qb-comparator",this._element).val():this._comparator},b.prototype.setComparator=function(b){this._comparator=b,this._element&&a(".qb-comparator",this._element).length&&a(".qb-comparator",this._element).val(b)},b.prototype.getKey=function(){return this._element?a(".qb-key option:selected",this._element).attr("value"):this._key},b.prototype.setKey=function(b){this._queryBuilder.changeCount(this._key,b),this._key=b,this._element&&a(".qb-key",this._element).val(b);var c=this.getDefinition().comparators;-1==c.indexOf(this.getComparator())&&this.setComparator(c[0]),this.initValue()},b.prototype.initValue=function(){var a=this.getDefinition(),b=a&&a.values?a.values:[],c=Object.keys(b);c&&-1==c.indexOf(this.getValue())&&d.call(this)==q&&this.setValue(c[0])},b.prototype.render=function(){var b=this,d=a('<div class="qb-rule"/>'),e=a('<select class="qb-key"/>'),f=this.getKey();d.data(m,this),d.append(e);var g=this.getDefinition();if(f||e.append('<option selected="selected" value="">- SELECT -</option>'),f&&!g&&e.append('<option selected="selected" value="'+f+'">'+f+"</option>"),a.each(this._queryBuilder.definitions(),function(c,d){var g=a('<option value="'+d.key+'">'+this.display+"</option>");f==d.key&&g.attr("selected","selected"),d.unique&&(g.addClass("unique-"+d.key),b._queryBuilder.getCount(d.key)&&g.attr("disabled","disabled")),e.append(g)}),g){g&&g.required&&g.count<=1&&e.attr("disabled","disabled"),g&&!g.dataType&&(g.dataType="string"),g&&!g.comparators&&(g.comparators=["eq"]);var h=a('<select class="qb-comparator"/>');d.append(h),a.each(g?g.comparators:[A],function(a,c){var d=b.getComparator()==c?' selected="selected"':"";h.append("<option"+d+' value="'+c+'">'+b._queryBuilder.getComparatorName(c)+"</option>")});var i=c.call(this);d.append(i)}var j=a('<button class="qb-button qb-remove-rule">x</button>');return d.append(j),g&&g.required&&g.count<=1&&j.hide(),!g&&this.getKey()&&(e.attr("disabled","disabled"),h.attr("disabled","disabled"),i.attr("disabled","disabled")),this._element&&this._element.replaceWith(d),this._element=d,d},b.prototype.getDefinition=function(){return this._queryBuilder.getDefinition(this.getKey())},b.prototype.getData=function(){return{key:this.getKey(),comparator:this.getComparator(),value:this.getValue()}},b.prototype.removeElement=function(){this._element&&this._element.removeElement()},b.prototype.getElement=function(){return this._element}}(),function(){function d(b){var c=this;b&&a.each(b,function(a){"object"==typeof this?this instanceof String?c.addRule(a,"eq",this):"key"in this&&"comparator"in this&&"value"in this?c.addRule(this.key,this.comparator,this.value):c.addRule(a,"in",this):c.addRule(a,"eq",this)})}c.prototype.constructor=c,c.prototype.setInputMethod=function(a,b){this._inputMethods[a]=b},c.prototype.getInputMethod=function(a){return this._inputMethods[a]},c.prototype.setInputType=function(a,b,c){this._inputTypes[a]||(this._inputTypes[a]={}),this._inputTypes[a][b]=c},c.prototype.getInputType=function(a,b){return this._inputTypes[a]&&this._inputTypes[a][b]?this._inputTypes[a][b]:this._inputTypes[A][v]},c.prototype.setComparatorName=function(a,b){this._comparatorNames[a]=b},c.prototype.getComparatorName=function(a){return this._comparatorNames[a]?this._comparatorNames[a]:a},c.prototype.init=function(b){var c=a(this._ele);c.addClass("qb-container").html(a('<div class="qb-rules"/>')).append(a('<button class="qb-button qb-add-rule">+</button>')),b=a.extend({},c.data(),b),this.options(b),this._options&&"definitions"in this._options&&this._options.definitions&&this.definitions(this._options.definitions),this._options&&"rules"in this._options&&this._options.rules&&this.rules(this._options.rules)},c.prototype.options=function(a){return void 0===a?this._options:(this._options=a,void this.redraw())},c.prototype.definitions=function(b){var c=this;return void 0===b?this._definitions:(this._initialisedDefinitions=!1,void("string"==typeof b?a.getJSON(b,{},function(b){c._definitions=[],a.each(b,function(){c._definitions.push(new O(this))}),c._initialisedDefinitions=!0,c.redraw()}):(this._definitions=[],a.each(b,function(){c._definitions.push(new O(this))}),c._initialisedDefinitions=!0,this.redraw())))},c.prototype.getDefinition=function(b){var c=null;return a.each(this._definitions,function(){return this.key==b?(c=this,!1):void 0}),c},c.prototype.rules=function(b){var c=this;if(void 0===b){var e=[];return a(this._rules).each(function(){this.getKey()&&e.push(this.getData())}),e}if(this._initialisedRules=!1,a.each(this._rules,function(){c.removeRule(this,!0)}),"object"==typeof b)return d.call(this,b),this._initialisedRules=!0,this.redraw(),null;if("function"==typeof b)return d.call(this,b()),this._initialisedRules=!0,this.redraw(),null;if("string"==typeof b)return a.getJSON(b,{},function(a){d.call(c,a),c._initialisedRules=!0,c.redraw()}),null;throw"Unknown data format for rules"},c.prototype.addRule=function(c,d,e){this.incrementCounter(c);var f=new b(this,c,d,e);this._rules.push(f),this._initialisedDefinitions&&this._initialisedRules&&a(".qb-rules",this._ele).append(f.render())},c.prototype.redraw=function(){if(this._initialisedDefinitions&&this._initialisedRules){var b=this;if(a(".qb-rules",this._ele).empty(),a.each(this._rules,function(){var c=this.render();a(".qb-rules",b._ele).append(c)}),b._definitions){if(a.each(b._definitions,function(){if(this.required){var c=this,d=!1;a.each(b._rules,function(){this.getKey()==c.key&&(d=!0)}),d||b.addRule(c.key,c.comparators[0],"")}}),0==this._rules.length&&this.addRule("","",""),this._definitions.length){var c=0;a.each(this._definitions,function(){this.required||c++}),c||a(".qb-add-rule").hide()}a(b._ele).trigger("change.querybuilder",[b.rules()])}}},c.prototype.removeRule=function(b,c){var d=this,e=b.getKey();this.decrementCounter(e),b.removeElement(),a.each(this._rules,function(a){this==b&&d._rules.splice(a,1)}),a(".qb-rule",this._ele).length||c||this.addRule("","","")},c.prototype.getCount=function(a){var b=this.getDefinition(a);return b?b.count:0},c.prototype.changeCount=function(a,b){this.decrementCounter(a),this.incrementCounter(b)},c.prototype.incrementCounter=function(b){var c=this.getDefinition(b);c&&(c.count++,c.unique&&a(".qb-key .unique-"+b,this._ele).attr("disabled","disabled"),c.required&&c.count>1&&a.each(this._rules,function(){this.getKey()==b&&(a(".qb-remove-rule",this.getElement()).show(),a(".qb-key",this.getElement()).attr("disabled",!1))}))},c.prototype.decrementCounter=function(b){var c=this.getDefinition(b);c&&(c.count--,c.unique&&0==c.count&&a(".qb-key .unique-"+b,this._ele).attr("disabled",null),c.required&&1==c.count&&a.each(this._rules,function(){this.getKey()==b&&a(".qb-remove-rule",this.getElement()).hide()}))}}()}(jQuery);var FortifiContentElements={};