var QueryBuilderConstants=QueryBuilderConstants||{};!function(a){"use strict";function b(a,b,c,d){this._queryBuilder=a,this._key=b||"",this._comparator=c||"",this._value=d||"",this._valCache={},this._valCache[this._comparator]=this._value,this._element=null}function c(a){this._ele=a,this._options={},this._definitions=[],this._rules=[],this._initialisedRules=!1,this._initialisedDefinitions=!1,this._inputMethods={},this._inputTypes={},this._comparatorNames={},this.setInputMethod(QueryBuilderConstants.INPUT_TEXT,d),this.setInputMethod(QueryBuilderConstants.INPUT_NUMBER,e),this.setInputMethod(QueryBuilderConstants.INPUT_DECIMAL,f),this.setInputMethod(QueryBuilderConstants.INPUT_SELECT,h),this.setInputMethod(QueryBuilderConstants.INPUT_DATE,i),this.setInputMethod(QueryBuilderConstants.INPUT_BOOL,g),this.setInputMethod(QueryBuilderConstants.INPUT_AGE,g),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TEXT),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS,QueryBuilderConstants.DATATYPE_BOOL,QueryBuilderConstants.INPUT_BOOL),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TEXT),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE,QueryBuilderConstants.DATATYPE_BOOL,QueryBuilderConstants.INPUT_BOOL),this.setInputType(QueryBuilderConstants.COMPARATOR_NOT_EQUAL,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TEXT),this.setInputType(QueryBuilderConstants.COMPARATOR_NOT_EQUAL,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_NOT_EQUAL,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_NOT_EQUAL,QueryBuilderConstants.DATATYPE_BOOL,QueryBuilderConstants.INPUT_BOOL),this.setInputType(QueryBuilderConstants.COMPARATOR_GREATER,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_GREATER,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_GREATER,QueryBuilderConstants.DATATYPE_DECIMAL,QueryBuilderConstants.INPUT_DECIMAL),this.setInputType(QueryBuilderConstants.COMPARATOR_GREATER_EQUAL,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_GREATER_EQUAL,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_GREATER_EQUAL,QueryBuilderConstants.DATATYPE_DECIMAL,QueryBuilderConstants.INPUT_DECIMAL),this.setInputType(QueryBuilderConstants.COMPARATOR_LESS,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_LESS,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_LESS,QueryBuilderConstants.DATATYPE_DECIMAL,QueryBuilderConstants.INPUT_DECIMAL),this.setInputType(QueryBuilderConstants.COMPARATOR_LESS_EQUAL,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_LESS_EQUAL,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_LESS_EQUAL,QueryBuilderConstants.DATATYPE_DECIMAL,QueryBuilderConstants.INPUT_DECIMAL),this.setInputType(QueryBuilderConstants.COMPARATOR_BETWEEN,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_NUMBER),this.setInputType(QueryBuilderConstants.COMPARATOR_BETWEEN,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_DATE),this.setInputType(QueryBuilderConstants.COMPARATOR_BETWEEN,QueryBuilderConstants.DATATYPE_DECIMAL,QueryBuilderConstants.INPUT_DECIMAL),this.setInputType(QueryBuilderConstants.COMPARATOR_AGE,QueryBuilderConstants.DATATYPE_DATE,QueryBuilderConstants.INPUT_AGE),this.setInputType(QueryBuilderConstants.COMPARATOR_LIKE,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TEXT),this.setInputType(QueryBuilderConstants.COMPARATOR_STARTS,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TEXT),this.setInputType(QueryBuilderConstants.COMPARATOR_ENDS,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TEXT),this.setComparatorName(QueryBuilderConstants.COMPARATOR_EQUALS,"Equals"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE,"Equals (insensitive)"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_EQUAL,"Does Not Equal"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_IN,"In"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_IN,"Not In"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_GREATER,"Greater Than"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_GREATER_EQUAL,"Greater Than or Equal to"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_LESS,"Less Than"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_LESS_EQUAL,"Less Than or Equal to"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_BETWEEN,"Between"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_AGE,"was"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_LIKE,"Like"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_STARTS,"Starts With"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_ENDS,"Ends With")}function d(){return a('<input type="text"/>').attr("value",this._value)}function e(){return a('<input type="number"/>').attr("value",this._value)}function f(){return a('<input type="number" step="0.01" />').attr("value",this.getValue())}function g(){return j({1:"True",0:"False"},this._value)}function h(){return j(this.getDefinition().values,this._value)}function i(){return a('<input type="date"/>').attr("value",this._value)}function j(b,c){var d=a("<select/>");if(c&&-1==Object.keys(b).indexOf(c)){var e=a("<option/>").text(c).attr("value",c);e.attr("selected","selected"),e.attr("disabled","disabled"),d.append(e)}return a.each(b,function(b){var e=a("<option/>").text(this).attr("value",b);b==c&&e.attr("selected","selected"),d.append(e)}),d}const k="querybuilder",l=k+".rule";QueryBuilderConstants.INPUT_TEXT="text",QueryBuilderConstants.INPUT_NUMBER="number",QueryBuilderConstants.INPUT_DECIMAL="decimal",QueryBuilderConstants.INPUT_SELECT="select",QueryBuilderConstants.INPUT_DATE="date",QueryBuilderConstants.INPUT_BOOL="bool",QueryBuilderConstants.INPUT_AGE="age",QueryBuilderConstants.DATATYPE_STRING="string",QueryBuilderConstants.DATATYPE_NUMBER="number",QueryBuilderConstants.DATATYPE_DECIMAL="decimal",QueryBuilderConstants.DATATYPE_DATE="date",QueryBuilderConstants.DATATYPE_BOOL="bool",QueryBuilderConstants.COMPARATOR_EQUALS="eq",QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE="eqi",QueryBuilderConstants.COMPARATOR_NOT_EQUAL="neq",QueryBuilderConstants.COMPARATOR_IN="in",QueryBuilderConstants.COMPARATOR_NOT_IN="nin",QueryBuilderConstants.COMPARATOR_GREATER="gt",QueryBuilderConstants.COMPARATOR_GREATER_EQUAL="gte",QueryBuilderConstants.COMPARATOR_LESS="lt",QueryBuilderConstants.COMPARATOR_LESS_EQUAL="lte",QueryBuilderConstants.COMPARATOR_BETWEEN="bet",QueryBuilderConstants.COMPARATOR_AGE="age",QueryBuilderConstants.COMPARATOR_LIKE="like",QueryBuilderConstants.COMPARATOR_STARTS="starts",QueryBuilderConstants.COMPARATOR_ENDS="ends",a.fn.QueryBuilder=function(b){var d=Array.prototype.slice.call(arguments);if(b?"object"==typeof b&&(b="init",d.unshift("init")):b="init","function"!=typeof c.prototype[b])throw"QueryBuilder command '"+b+"' not found";d.shift();var e=a(this);return a(this).each(function(){var f=a(this),g=f.data(k);g||(f.data(k,new c(this)),g=f.data(k));var h=g[b].apply(g,d);h&&(e=h)}),e},a(document).on("change",".qb-rule .qb-key",function(){var b=a(this).closest(".qb-container"),c=(b.data(k),a(this).closest(".qb-rule")),d=c.data(l);d.setKey(a(this).val())}),a(document).on("change",".qb-rule .qb-comparator",function(){var b=a(this).closest(".qb-container"),c=(b.data(k),a(this).closest(".qb-rule")),d=c.data(l);d.setComparator(a(this).val())}),a(document).on("change",".qb-container .qb-value",function(){var b=a(this).closest(".qb-container"),c=(b.data(k),a(this).closest(".qb-rule")),d=c.data(l);d.setValue(a(this).val())}),a(document).on("click","button.qb-remove-rule",function(){var b=a(this).closest(".qb-container"),c=b.data(k),d=a(this).closest(".qb-rule"),e=d.data(l);c.removeRule(e)}),a(document).on("click","button.qb-add-rule",function(){a(this).closest(".qb-container").QueryBuilder("addRule")});var m=function(b){if(this.key="",this.display="- SELECT -",this.dataType=QueryBuilderConstants.DATATYPE_STRING,this.comparators=[QueryBuilderConstants.COMPARATOR_EQUALS],this.inputType=null,this.required=!1,this.unique=!1,this.values="",this.ajaxUrl="",this.count=0,b){var c=this;a.each(b,function(a,b){c.hasOwnProperty(a)&&(c[a]=b)})}};!function(){function c(){var a,b=this.getInputType(this),c=this._queryBuilder.getInputMethod(b);if(!c)throw"Input type not found for "+this.getComparator()+" "+this.getDefinition().dataType;return a=c.call(this),a.addClass("qb-value"),a}b.prototype.constructor=b,b.prototype.getInputType=function(){var a=this.getDefinition(),b=this._queryBuilder,c=a&&a.inputType?a.inputType:null;if(!c){var d=a&&a.dataType?a.dataType:QueryBuilderConstants.DATATYPE_STRING;c=b.getInputType(this.getComparator(),d)}return c==QueryBuilderConstants.INPUT_TEXT&&a&&a.values&&!a.ajaxUrl&&(c=QueryBuilderConstants.INPUT_SELECT),c},b.prototype.getValue=function(){return this._value},b.prototype.setValue=function(b){this._value=b,this._element&&a(".qb-value",this._element).length&&a(".qb-value",this._element).val(b),a(this._queryBuilder._ele).trigger("change.querybuilder",[this._queryBuilder.rules()])},b.prototype.getComparator=function(){return this._comparator},b.prototype.setComparator=function(b){this._valCache[this._comparator]=this.getValue(),this._comparator=b,this._element&&a(".qb-comparator",this._element).length&&a(".qb-comparator",this._element).val(b),this._valCache[this._comparator]?(this.setValue(this._valCache[this._comparator]),this.render()):(this.render(),a(this._queryBuilder._ele).trigger("change.querybuilder",[this._queryBuilder.rules()]))},b.prototype.getKey=function(){return this._key},b.prototype.setKey=function(b){this._queryBuilder.changeCount(this._key,b),this._key=b,this._element&&a(".qb-key",this._element).val(b);var c=this.getDefinition().comparators;-1==c.indexOf(this.getComparator())&&this.setComparator(c[0]),this.setValue(""),this.render()},b.prototype.render=function(){var b=this,d=a('<div class="qb-rule"/>'),e=a('<select class="qb-key"/>'),f=this.getKey();d.data(l,this),d.append(e);var g=this.getDefinition();if(f||e.append('<option selected="selected" value="">- SELECT -</option>'),f&&!g&&e.append('<option selected="selected" value="'+f+'">'+f+"</option>"),a.each(this._queryBuilder.definitions(),function(c,d){var g=a('<option value="'+d.key+'">'+this.display+"</option>");f==d.key&&g.attr("selected","selected"),d.unique&&(g.addClass("unique-"+d.key),b._queryBuilder.getCount(d.key)&&g.attr("disabled","disabled")),e.append(g)}),g){g&&g.required&&g.count<=1&&e.attr("disabled","disabled"),g&&!g.dataType&&(g.dataType="string"),g&&!g.comparators&&(g.comparators=["eq"]);var h=a('<select class="qb-comparator"/>');g.dataType!=QueryBuilderConstants.DATATYPE_BOOL&&d.append(h),a.each(g?g.comparators:[QueryBuilderConstants.COMPARATOR_EQUALS],function(a,c){var d=b.getComparator()==c?' selected="selected"':"";h.append("<option"+d+' value="'+c+'">'+b._queryBuilder.getComparatorName(c)+"</option>")});var i=c.call(this);i.is("select")&&0==a("option[selected]",i).length&&this.setValue(a("option",i).first().attr("selected","selected").attr("value")),d.append(i)}var j=a('<button class="qb-button qb-remove-rule">x</button>');return d.append(j),g&&g.required&&g.count<=1&&j.hide(),!g&&this.getKey()&&(e.attr("disabled","disabled"),h.attr("disabled","disabled"),i.attr("disabled","disabled")),this._element?(this._element.replaceWith(d),this._element=d,a(this._queryBuilder._ele).trigger("render.querybuilder",this)):this._element=d,d},b.prototype.getDefinition=function(){return this._queryBuilder.getDefinition(this.getKey())},b.prototype.getData=function(){return{key:this.getKey(),comparator:this.getComparator(),value:this.getValue()}},b.prototype.removeElement=function(){this._element&&this._element.remove()},b.prototype.getElement=function(){return this._element}}(),function(){function d(b){var c=this;b&&a.each(b,function(a){"object"==typeof this?this instanceof String?c.addRule(a,"eq",this):"key"in this&&"comparator"in this&&"value"in this?c.addRule(this.key,this.comparator,this.value):c.addRule(a,"in",this):c.addRule(a,"eq",this)})}c.prototype.constructor=c,c.prototype.setInputMethod=function(a,b){this._inputMethods[a]=b},c.prototype.getInputMethod=function(a){return this._inputMethods[a]},c.prototype.setInputType=function(a,b,c){this._inputTypes[a]||(this._inputTypes[a]={}),this._inputTypes[a][b]=c},c.prototype.getInputType=function(a,b){return this._inputTypes[a]&&this._inputTypes[a][b]?this._inputTypes[a][b]:this._inputTypes[QueryBuilderConstants.COMPARATOR_EQUALS][QueryBuilderConstants.DATATYPE_STRING]},c.prototype.setComparatorName=function(a,b){this._comparatorNames[a]=b},c.prototype.getComparatorName=function(a){return this._comparatorNames[a]?this._comparatorNames[a]:a},c.prototype.init=function(b){var c=a(this._ele);c.addClass("qb-container").html(a('<div class="qb-rules"/>')).append(a('<button class="qb-button qb-add-rule">+</button>')),c.trigger("init.querybuilder",this),b=a.extend({},c.data(),b),this.options(b),this._options&&"definitions"in this._options&&this._options.definitions&&this.definitions(this._options.definitions),this._options&&"rules"in this._options&&this._options.rules&&this.rules(this._options.rules)},c.prototype.options=function(a){return void 0===a?this._options:(this._options=a,void this.redraw())},c.prototype.definitions=function(b){var c=this;return void 0===b?this._definitions:(this._initialisedDefinitions=!1,void("string"==typeof b?a.getJSON(b,{},function(b){c._definitions=[],a.each(b,function(){c._definitions.push(new m(this))}),c._initialisedDefinitions=!0,c.redraw()}):(this._definitions=[],a.each(b,function(){c._definitions.push(new m(this))}),c._initialisedDefinitions=!0,this.redraw())))},c.prototype.getDefinition=function(b){var c=null;return a.each(this._definitions,function(){return this.key==b?(c=this,!1):void 0}),c},c.prototype.rules=function(b){var c=this;if(void 0===b){var e=[];return a(this._rules).each(function(){this.getKey()&&e.push(this.getData())}),e}if(this._initialisedRules=!1,a.each(this._rules,function(){c.removeRule(this,!0)}),"object"==typeof b)return d.call(this,b),this._initialisedRules=!0,this.redraw(),null;if("function"==typeof b)return d.call(this,b()),this._initialisedRules=!0,this.redraw(),null;if("string"==typeof b)return a.getJSON(b,{},function(a){d.call(c,a),c._initialisedRules=!0,c.redraw()}),null;throw"Unknown data format for rules"},c.prototype.addRule=function(c,d,e){this.incrementCounter(c);var f=new b(this,c,d,e);if(this._rules.push(f),this._initialisedDefinitions&&this._initialisedRules){var g=f.render();a(".qb-rules",this._ele).append(g),a(this._ele).trigger("render.querybuilder",f)}},c.prototype.redraw=function(){if(this._initialisedDefinitions&&this._initialisedRules){var b=this;if(a(".qb-rules",this._ele).empty(),a.each(this._rules,function(){var c=this.render();a(".qb-rules",b._ele).append(c),a(b._ele).trigger("render.querybuilder",this)}),b._definitions){if(a.each(b._definitions,function(){if(this.required){var c=this,d=!1;a.each(b._rules,function(){this.getKey()==c.key&&(d=!0)}),d||b.addRule(c.key,c.comparators[0],"")}}),0==this._rules.length&&this.addRule("","",""),this._definitions.length){var c=0;a.each(this._definitions,function(){this.required||c++}),c||a(".qb-add-rule").hide()}a(b._ele).trigger("change.querybuilder",[b.rules()])}}},c.prototype.removeRule=function(b,c){var d=this,e=b.getKey();this.decrementCounter(e),b.removeElement(),a.each(this._rules,function(a){this==b&&d._rules.splice(a,1)}),a(".qb-rule",this._ele).length||c||this.addRule("","",""),a(this._ele).trigger("change.querybuilder",[this.rules()])},c.prototype.getCount=function(a){var b=this.getDefinition(a);return b?b.count:0},c.prototype.changeCount=function(a,b){this.decrementCounter(a),this.incrementCounter(b)},c.prototype.incrementCounter=function(b){var c=this.getDefinition(b);c&&(c.count++,c.unique&&a(".qb-key .unique-"+b,this._ele).attr("disabled","disabled"),c.required&&c.count>1&&a.each(this._rules,function(){this.getKey()==b&&(a(".qb-remove-rule",this.getElement()).show(),a(".qb-key",this.getElement()).attr("disabled",!1))}))},c.prototype.decrementCounter=function(b){var c=this.getDefinition(b);c&&(c.count--,c.unique&&0==c.count&&a(".qb-key .unique-"+b,this._ele).attr("disabled",null),c.required&&1==c.count&&a.each(this._rules,function(){this.getKey()==b&&a(".qb-remove-rule",this.getElement()).hide()}))}}()}(jQuery);var QueryBuilderConstants=QueryBuilderConstants||{};!function(){function a(){var a=$('<select multiple="multiple" class="qb-input qb-tokenizer"/>');if(this.getDefinition().values){var b=$.extend({},this.getDefinition().values),c=this._value;c instanceof Object||(c=[c]),$.each(c,function(a,c){-1==Object.keys(b).indexOf(c)&&(b[c]=c)}),$.each(b,function(b){var d=$("<option/>").text(this).attr("value",b);c.indexOf(b)>-1&&d.attr("selected","selected"),a.append(d)})}return a}QueryBuilderConstants.INPUT_TOKEN="token",$(document).on("render.querybuilder",function(a,b){function c(a,c,e){var f=d.tokenize().toArray();b.setValue(f.length?f:"")}var d=$(".qb-tokenizer",b.getElement());d.length&&d.tokenize({autosize:!0,onAddToken:c,onRemoveToken:c})}),$(document).on("init.querybuilder",function(b,c){c.setInputMethod(QueryBuilderConstants.INPUT_TOKEN,a),c.setInputType(QueryBuilderConstants.COMPARATOR_IN,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TOKEN),c.setInputType(QueryBuilderConstants.COMPARATOR_IN,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_TOKEN),c.setInputType(QueryBuilderConstants.COMPARATOR_NOT_IN,QueryBuilderConstants.DATATYPE_STRING,QueryBuilderConstants.INPUT_TOKEN),c.setInputType(QueryBuilderConstants.COMPARATOR_NOT_IN,QueryBuilderConstants.DATATYPE_NUMBER,QueryBuilderConstants.INPUT_TOKEN)})}();var FortifiContentElements={};