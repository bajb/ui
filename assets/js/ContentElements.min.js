!function(a,b,c,d){"use strict";function e(b){this.key="",this.displayName="- SELECT -",this.dataType=QueryBuilderConstants.DATATYPE_STRING,this.comparators=[QueryBuilderConstants.COMPARATOR_EQUALS],this.inputType=null,this.required=!1,this.unique=!1,this.values=null,this.valuesUrl="",this.strictValues=!0,this.count=0;var c=this;if(b&&a.each(b,function(a,b){c.hasOwnProperty(a)&&(c[a]=b)}),this.values&&this.values instanceof Array){var d={};a(this.values).each(function(a){d[c.values[a]]=c.values[a]}),this.values=d}}function f(a,b,c,d){this._queryBuilder=a,this._key=b||"",this._comparator=c||"",this._value=null!==d?d:null,this._valCache={},this._valCache[this._comparator]=this._value,this._element=null}function g(a){this._ele=a,this._options={},this._definitions=[],this._rules=[new f(this,"","",null)],this._initialisedRules=!1,this._initialisedDefinitions=!1,this._inputTypeProcessors=[],this._inputMethods={},this._comparatorNames={},this.setInputMethod(QueryBuilderConstants.INPUT_TEXT,k),this.setInputMethod(QueryBuilderConstants.INPUT_NUMBER,o),this.setInputMethod(QueryBuilderConstants.INPUT_DECIMAL,n),this.setInputMethod(QueryBuilderConstants.INPUT_SELECT,m),this.setInputMethod(QueryBuilderConstants.INPUT_DATE,p),this.setInputMethod(QueryBuilderConstants.INPUT_BOOL,l),this.setInputMethod(QueryBuilderConstants.INPUT_AGE,q),this.setInputMethod(QueryBuilderConstants.INPUT_BETWEEN,r),this.setComparatorName(QueryBuilderConstants.COMPARATOR_EQUALS,"Equals"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE,"Equals (insensitive)"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_EQUALS_INSENSITIVE,"Does Not Equal (insensitive)"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_EQUAL,"Does Not Equal"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_IN,"In"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_IN,"Not In"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_GREATER,"Greater Than"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_GREATER_EQUAL,"Greater Than or Equal to"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_LESS,"Less Than"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_LESS_EQUAL,"Less Than or Equal to"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_BETWEEN,"Between"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_BETWEEN,"Not Between"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_LIKE,"Like"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_LIKE,"Not Like"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_STARTS,"Starts With"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_STARTS,"Does Not Start With"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_ENDS,"Ends With"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_NOT_ENDS,"Does Not End With"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_BEFORE,"Was Before"),this.setComparatorName(QueryBuilderConstants.COMPARATOR_AFTER,"Was After"),this.addInputTypeProcessor(function(a,b){return b==QueryBuilderConstants.DATATYPE_NUMBER?QueryBuilderConstants.INPUT_NUMBER:b==QueryBuilderConstants.DATATYPE_DECIMAL?QueryBuilderConstants.INPUT_DECIMAL:void 0}),this.addInputTypeProcessor(function(a,b){return b==QueryBuilderConstants.DATATYPE_BOOL?QueryBuilderConstants.INPUT_BOOL:void 0}),this.addInputTypeProcessor(function(a,b){return b==QueryBuilderConstants.DATATYPE_DATE?QueryBuilderConstants.INPUT_DATE:void 0}),this.addInputTypeProcessor(function(a,b){return a==QueryBuilderConstants.COMPARATOR_BETWEEN||a==QueryBuilderConstants.COMPARATOR_NOT_BETWEEN?QueryBuilderConstants.INPUT_BETWEEN:void 0}),this.addInputTypeProcessor(function(a,b){return a==QueryBuilderConstants.COMPARATOR_BEFORE||a==QueryBuilderConstants.COMPARATOR_AFTER?QueryBuilderConstants.INPUT_AGE:void 0}),this.addInputTypeProcessor(function(a,b,c){var d=c.getDefinition();return d&&d.hasValues()&&d.isStrict()?QueryBuilderConstants.INPUT_SELECT:void 0})}function h(b,c){var d=a("<select/>");if(c&&-1==Object.keys(b).indexOf(c)){var e=a("<option/>").text(c).attr("value",c);e.attr("selected","selected"),e.attr("disabled","disabled"),d.append(e)}return a.each(b,function(b){var e=a("<option/>").text(this).attr("value",b);b==c&&e.attr("selected","selected"),d.append(e)}),d}b.QueryBuilderConstants=b.QueryBuilderConstants||{};var i="querybuilder",j=i+".rule";QueryBuilderConstants.INPUT_TEXT="text",QueryBuilderConstants.INPUT_NUMBER="number",QueryBuilderConstants.INPUT_DECIMAL="decimal",QueryBuilderConstants.INPUT_SELECT="select",QueryBuilderConstants.INPUT_DATE="date",QueryBuilderConstants.INPUT_BOOL="bool",QueryBuilderConstants.INPUT_AGE="age",QueryBuilderConstants.INPUT_BETWEEN="between",QueryBuilderConstants.DATATYPE_STRING="string",QueryBuilderConstants.DATATYPE_NUMBER="number",QueryBuilderConstants.DATATYPE_DECIMAL="decimal",QueryBuilderConstants.DATATYPE_DATE="date",QueryBuilderConstants.DATATYPE_BOOL="bool",QueryBuilderConstants.COMPARATOR_EQUALS="eq",QueryBuilderConstants.COMPARATOR_NOT_EQUAL="neq",QueryBuilderConstants.COMPARATOR_EQUALS_INSENSITIVE="eqi",QueryBuilderConstants.COMPARATOR_NOT_EQUALS_INSENSITIVE="neqi",QueryBuilderConstants.COMPARATOR_IN="in",QueryBuilderConstants.COMPARATOR_NOT_IN="nin",QueryBuilderConstants.COMPARATOR_GREATER="gt",QueryBuilderConstants.COMPARATOR_GREATER_EQUAL="gte",QueryBuilderConstants.COMPARATOR_LESS="lt",QueryBuilderConstants.COMPARATOR_LESS_EQUAL="lte",QueryBuilderConstants.COMPARATOR_BETWEEN="bet",QueryBuilderConstants.COMPARATOR_NOT_BETWEEN="nbet",QueryBuilderConstants.COMPARATOR_LIKE="like",QueryBuilderConstants.COMPARATOR_NOT_LIKE="nlike",QueryBuilderConstants.COMPARATOR_STARTS="starts",QueryBuilderConstants.COMPARATOR_NOT_STARTS="nstarts",QueryBuilderConstants.COMPARATOR_ENDS="ends",QueryBuilderConstants.COMPARATOR_NOT_ENDS="nends",QueryBuilderConstants.COMPARATOR_BEFORE="before",QueryBuilderConstants.COMPARATOR_AFTER="after",a.fn.QueryBuilder=function(b){var c=Array.prototype.slice.call(arguments);if(b?"object"==typeof b&&(b="init",c.unshift("init")):b="init","function"!=typeof g.prototype[b])throw"QueryBuilder command '"+b+"' not found";c.shift();var d=a(this);return a(this).each(function(){var e=a(this),f=e.data(i);f||(e.data(i,new g(this)),f=e.data(i));var h=f[b].apply(f,c);h&&(d=h)}),d},a(c).on("change",".qb-rule .qb-key",function(){var b=a(this).closest(".qb-container"),c=(b.data(i),a(this).closest(".qb-rule")),d=c.data(j);d.setKey(a(this).val())}),a(c).on("change",".qb-rule .qb-comparator",function(){var b=a(this).closest(".qb-container"),c=(b.data(i),a(this).closest(".qb-rule")),d=c.data(j);d.setComparator(a(this).val())}),a(c).on("click","button.qb-remove-rule",function(){var b=a(this).closest(".qb-container"),c=b.data(i),d=a(this).closest(".qb-rule"),e=d.data(j);c.removeRule(e)}),a(c).on("click","button.qb-add-rule",function(){a(this).closest(".qb-container").QueryBuilder("addRule")}),function(){e.prototype.hasValues=function(){return!!this.values},e.prototype.hasAjaxValues=function(){return!!this.valuesUrl},e.prototype.isStrict=function(){return!!this.strictValues}}(),function(){function b(){var a=this._queryBuilder.getInputTypeForRule(this),b=this._queryBuilder.getInputMethod(a);if(!b)throw"Input type not found for "+this.getComparator()+" "+this.getDefinition().dataType;return new b(this)}f.prototype.constructor=f,f.prototype.getValue=function(){return this._value},f.prototype.setValue=function(b){this._setValue(b),this.render(),a(this._queryBuilder._ele).trigger("change.querybuilder",[this._queryBuilder.rules()])},f.prototype._setValue=function(b){this._value=b,a(this._queryBuilder._ele).trigger("change.querybuilder",[this._queryBuilder.rules()])},f.prototype.getComparator=function(){return this._comparator},f.prototype.setComparator=function(b){this._valCache[this._comparator]=this.getValue(),this._comparator=b,this._element&&a(".qb-comparator",this._element).length&&a(".qb-comparator",this._element).val(b),this.setValue(this._valCache[this._comparator]?this._valCache[this._comparator]:null)},f.prototype.getKey=function(){return this._key},f.prototype.setKey=function(b){this._queryBuilder.changeCount(this._key,b),this._key=b,this._element&&a(".qb-key",this._element).val(b);var c=this.getDefinition().comparators;-1==c.indexOf(this.getComparator())?this.setComparator(c[0]):this.setValue(null)},f.prototype.render=function(){var c=this,d=a('<div class="qb-rule"/>'),e=a('<select class="qb-key"/>'),f=this.getKey();d.data(j,this),d.append(e);var g=this.getDefinition();if(f||e.append('<option selected="selected" value="">- SELECT -</option>'),f&&!g&&e.append('<option selected="selected" value="'+f+'">'+f+"</option>"),a.each(this._queryBuilder.definitions(),function(b,d){var g=a('<option value="'+d.key+'">'+this.displayName+"</option>");f==d.key&&g.attr("selected","selected"),d.unique&&(g.addClass("unique-"+d.key),c._queryBuilder.getCount(d.key)&&g.attr("disabled","disabled")),e.append(g)}),g){g&&g.required&&g.count<=1&&e.attr("disabled","disabled"),g&&!g.dataType&&(g.dataType="string"),g&&!g.comparators&&(g.comparators=["eq"]);var h=a('<select class="qb-comparator"/>');g.dataType!=QueryBuilderConstants.DATATYPE_BOOL&&d.append(h),a.each(g?g.comparators:[QueryBuilderConstants.COMPARATOR_EQUALS],function(a,b){var d=c.getComparator()==b?' selected="selected"':"";h.append("<option"+d+' value="'+b+'">'+c._queryBuilder.getComparatorName(b)+"</option>")});var i=b.call(this),k=i.render();null===this.getValue()&&k.is("select")&&0==a("option[selected]",k).length&&this.setValue(a("option",k).first().attr("selected","selected").attr("value")),d.append(k),i.postRender&&i.postRender()}var l=a('<button class="qb-button qb-remove-rule">x</button>');return d.append(l),g&&g.required&&g.count<=1&&l.hide(),!g&&this.getKey()&&(e.attr("disabled","disabled"),h.attr("disabled","disabled"),k.attr("disabled","disabled")),this._element?(this._element.replaceWith(d),this._element=d,a(this._queryBuilder._ele).trigger("render.querybuilder",this)):this._element=d,d},f.prototype.getDefinition=function(){return this._queryBuilder.getDefinition(this.getKey())},f.prototype.getData=function(){return{key:this.getKey(),comparator:this.getComparator(),value:this.getValue()}},f.prototype.removeElement=function(){this._element&&this._element.remove()},f.prototype.getElement=function(){return this._element}}(),function(){function b(a){if(this._definitions.length>0)c.call(this,a);else var b=this,d=setInterval(function(){b._definitions.length>0&&(c.call(b,a),clearInterval(d))},100)}function c(b){for(var c=this;this._rules.length;)c.removeRule(this._rules[0],!0);b&&(a.each(b,function(a){"object"==typeof this?this instanceof String?c.addRule(a,"eq",this):"key"in this&&"comparator"in this&&"value"in this?c.addRule(this.key,this.comparator,this.value):1==this.length?c.addRule(a,"eq",this[0]):c.addRule(a,"in",this):c.addRule(a,"eq",this)}),c._initialisedRules=!0,this.redraw(),c._rules.length||c.addRule("","",null))}g.prototype.constructor=g,g.prototype.setInputMethod=function(a,b){this._inputMethods[a]=b},g.prototype.getInputMethod=function(a){return this._inputMethods[a]},g.prototype.setComparatorName=function(a,b){this._comparatorNames[a]=b},g.prototype.getComparatorName=function(a){return this._comparatorNames[a]?this._comparatorNames[a]:a},g.prototype.addInputTypeProcessor=function(a){this._inputTypeProcessors.push(a)},g.prototype.getInputTypeForRule=function(b){var c=b.getDefinition();if(c&&c.inputType)return c.inputType;var d=c&&c.dataType?c.dataType:QueryBuilderConstants.DATATYPE_STRING,e=QueryBuilderConstants.INPUT_TEXT;return a(this._inputTypeProcessors).each(function(){e=this(b.getComparator(),d,b)||e}),e},g.prototype.init=function(b){var c=a(this._ele);c.addClass("qb-container").html(a('<div class="qb-rules"/>')).append(a('<button class="qb-button qb-add-rule">+</button>')),c.trigger("init.querybuilder",this),b=a.extend({},c.data(),b),this.options(b),this._options&&"definitions"in this._options&&this._options.definitions&&this.definitions(this._options.definitions),this._options&&"rules"in this._options&&this._options.rules&&this.rules(this._options.rules)},g.prototype.options=function(a){return a===d?this._options:(this._options=a,void this.redraw())},g.prototype.definitions=function(b){var c=this;return b===d?this._definitions:(this._initialisedDefinitions=!1,void("string"==typeof b?a.getJSON(b,{},function(b){c._definitions=[],a.each(b,function(){c._definitions.push(new e(this))}),c._initialisedDefinitions=!0,c.redraw()}):(this._definitions=[],a.each(b,function(){c._definitions.push(new e(this))}),c._initialisedDefinitions=!0,this.redraw())))},g.prototype.getDefinition=function(b){var c=null;return a.each(this._definitions,function(){return this.key==b?(c=this,!1):void 0}),c},g.prototype.rules=function(c){var e=this;if(c===d){var f=[];return a(this._rules).each(function(){this.getKey()&&f.push(this.getData())}),f}if(this._initialisedRules=!1,"object"==typeof c)return b.call(this,c),null;if("function"==typeof c)return b.call(this,c()),null;if("string"==typeof c)return a.getJSON(c,{},function(a){b.call(e,a)}),null;throw"Unknown data format for rules"},g.prototype.addRule=function(b,c,d){this.incrementCounter(b);var e=new f(this,b,c,d);if((!b||e.getDefinition())&&(this._rules.push(e),this._initialisedDefinitions)){var g=e.render();a(".qb-rules",this._ele).append(g),a(this._ele).trigger("render.querybuilder",e)}},g.prototype.redraw=function(){if(this._initialisedDefinitions){var b=this;if(a(".qb-rules",this._ele).empty(),a.each(this._rules,function(){var c=this.render();a(".qb-rules",b._ele).append(c),a(b._ele).trigger("render.querybuilder",this)}),b._definitions&&(a.each(b._definitions,function(){if(this.required){var c=this,d=!1;a.each(b._rules,function(){this.getKey()==c.key&&(d=!0)}),d||b.addRule(c.key,c.comparators[0],null)}}),this._definitions.length)){var c=0;a.each(this._definitions,function(){this.unique||c++}),c||a(".qb-add-rule").hide()}this._initialisedRules&&a(b._ele).trigger("change.querybuilder",[b.rules()])}},g.prototype.removeRule=function(b,c){var d=this,e=b.getKey();this.decrementCounter(e),b.removeElement(),a.each(this._rules,function(a){this==b&&d._rules.splice(a,1)}),a(".qb-rule",this._ele).length||c||this.addRule("","",null),a(this._ele).trigger("change.querybuilder",[this.rules()])},g.prototype.getCount=function(a){var b=this.getDefinition(a);return b?b.count:0},g.prototype.changeCount=function(a,b){this.decrementCounter(a),this.incrementCounter(b)},g.prototype.incrementCounter=function(b){var c=this.getDefinition(b);c&&(c.count++,c.unique&&a(".qb-key .unique-"+b,this._ele).attr("disabled","disabled"),c.required&&c.count>1&&a.each(this._rules,function(){this.getKey()==b&&(a(".qb-remove-rule",this.getElement()).show(),a(".qb-key",this.getElement()).attr("disabled",!1))}))},g.prototype.decrementCounter=function(b){var c=this.getDefinition(b);c&&(c.count--,c.unique&&0==c.count&&a(".qb-key .unique-"+b,this._ele).attr("disabled",null),c.required&&1==c.count&&a.each(this._rules,function(){this.getKey()==b&&a(".qb-remove-rule",this.getElement()).hide()}))}}();var k=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value="")}return b.prototype.render=function(){var b=this;return a('<input type="text"/>').attr("value",this._rule._value).on("change",function(){b._rule._setValue(a(this).val())})},b}(),l=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value="1")}return b.prototype.render=function(){var b=this;return h({1:"True",0:"False"},this._rule._value).on("change",function(){b._rule._setValue(a(this).val())})},b}(),m=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value=null)}return b.prototype.render=function(){var b=this;return h(this._rule.getDefinition().values,this._rule._value).on("change",function(){b._rule._setValue(a(this).val())})},b}(),n=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value=0)}return b.prototype.render=function(){var b=this;return a('<input type="number" step="0.01" />').attr("value",this._rule._value).on("change",function(){b._rule._setValue(a(this).val())})},b}(),o=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value=0)}return b.prototype.render=function(){var b=this;return a('<input type="number" />').attr("value",this._rule._value).on("change",function(){b._rule._setValue(a(this).val())})},b}(),p=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value=c())}function c(){var a=new Date,b=a.getFullYear();return b+="-"+("0"+(a.getMonth()+1)).slice(-2),b+="-"+("0"+a.getDate()).slice(-2)}return b.prototype.render=function(){var b=this;return a('<input type="date" />').val(this._rule._value).on("change",function(){b._rule._setValue(a(this).val())})},b}(),q=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule._value=-10080)}return b.prototype.render=function(){var b=this,c=this._rule._value,d=1,e=a('<input class="age-count" type="number" />'),f=a('<select class="age-unit"/>'),g=a('<select class="age-unit"></select>'),h={Minutes:1,Hours:60,Days:1440,Weeks:10080},i=[];for(var j in h)h.hasOwnProperty(j)&&i.push([j,h[j]]);i.sort(function(a,b){return a[1]-b[1]}),a.each(i.slice().reverse(),function(a,b){return c%b[1]==0?(d=b[1],c/=b[1],!1):void 0}),a.each(i,function(b,c){var e=a("<option>").val(c[1]).text(c[0]);d==c[1]&&e.attr("selected",!0),f.append(e)}),e.val(Math.abs(c));var k=a('<option value="-1">Ago</option>'),l=a('<option value="1">From now</option>');this._rule._value<=0?k.attr("selected",!0):l.attr("selected",!0),g.append(k,l);var m=a().add(e).add(f).add(g);return m.on("change",function(){b._rule._setValue(e.val()*f.val()*g.val())}),m},b}(),r=function(){function b(a){this._rule=a,null===this._rule._value&&(this._rule.getDefinition().dataType==QueryBuilderConstants.DATATYPE_DATE?this._rule._value=c()+","+c():this._rule._value="0,0")}function c(){var a=new Date,b=a.getFullYear();return b+="-"+("0"+(a.getMonth()+1)).slice(-2),b+="-"+("0"+a.getDate()).slice(-2)}return b.prototype.render=function(){var b=this,c=this._rule._value.split(","),d=a('<input class="qb-between-min">'),e=a('<input class="qb-between-max">');switch(this._rule.getDefinition().dataType){case QueryBuilderConstants.DATATYPE_DECIMAL:d.attr("type","number").attr("step","0.01").val(c[0]),e.attr("type","number").attr("step","0.01").val(c[1]);break;case QueryBuilderConstants.DATATYPE_NUMBER:d.attr("type","number").val(c[0]),e.attr("type","number").val(c[1]);break;case QueryBuilderConstants.DATATYPE_DATE:d.attr("type","date").val(c[0]),e.attr("type","date").val(c[1]);break;default:d.attr("type","text").val(c[0]),e.attr("type","text").val(c[1])}var f=a().add(d).add(e);return f.on("change",function(){b._rule._setValue(d.val()+","+e.val())}),f},b}()}(jQuery,window,document),function(a,b,c){"use strict";function d(a,b,c){var d=c.getDefinition();return d&&(d.hasAjaxValues()||d.hasValues()&&!d.isStrict()||a==QueryBuilderConstants.COMPARATOR_IN||a==QueryBuilderConstants.COMPARATOR_NOT_IN)?e:void 0}b.QueryBuilderConstants=b.QueryBuilderConstants||{};var e="token",f=function(){function b(a){this._rule=a,this._selectBox=null,null===this._rule._value&&(this._rule._value="")}return b.prototype.tokenChanged=function(a,b,c){var d=this._selectBox.tokenize(),e=d.toArray();1===d.options.maxElements&&1===e.length&&(e=e[0]),this._rule._setValue(e.length?e:"")},b.prototype.render=function(){return this._selectBox=a('<select class="qb-tokenizer qb-input"/>')},b.prototype.postRender=function(){var b=this,c=this._rule.getDefinition(),d=this._rule._value,e={debounce:250,autosize:!0,onAddToken:function(a,c,d){b.tokenChanged(a,c,d)},onRemoveToken:function(a,c,d){b.tokenChanged(a,c,d)}};if(d instanceof Object||(d=[d]),c.hasValues()){var f=a.extend({},c.values);a.each(d,function(a,b){-1==Object.keys(f).indexOf(b)&&(f[b]=b)}),a.each(f,function(c){if(c){var e=a("<option/>").text(f[c]).val(encodeURIComponent(c));d.indexOf(c)>-1&&e.attr("selected","selected"),b._selectBox.append(e)}})}c.isStrict()&&(e.newElements=!1),c.hasAjaxValues()&&(e.datas=c.valuesUrl),[QueryBuilderConstants.COMPARATOR_IN,QueryBuilderConstants.COMPARATOR_NOT_IN].indexOf(this._rule.getComparator())<0&&(e.maxElements=1),this._selectBox.tokenize(e),a.each(d,function(a,c){b._selectBox.tokenize().dropdownAddItem(c,c).tokenAdd(c,c)})},b}();a(c).on("init.querybuilder",function(a,b){b.setInputMethod(e,f),b.addInputTypeProcessor(d)})}(jQuery,window,document);var FortifiContentElements={};